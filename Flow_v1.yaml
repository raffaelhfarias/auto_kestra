id: envio_resultados
namespace: company.team

tasks:
  - id: wdir
    type: io.kestra.plugin.core.flow.WorkingDirectory
    tasks:
    - id: sync_github
      type: io.kestra.plugin.git.SyncNamespaceFiles
      username: "{{ kv('GITHUB_USER') }}"
      password: "{{ kv('GITHUB_PASS') }}"
      url: https://github.com/raffaelhfarias/auto_kestra
      branch: main
      namespace: company.team
      gitDirectory: .
      dryRun: false

    - id: exe_loja
      description: Realizar a extração dos resultados de loja
      type: io.kestra.plugin.scripts.python.Commands
      containerImage: mcr.microsoft.com/playwright/python:v1.57.0-noble
      namespaceFiles:
        enabled: true
      env:
        LOJA_USER: "{{ kv('LOJA_USER') }}"
        LOJA_PASS: "{{ kv('LOJA_PASS') }}"
      beforeCommands:
        - pip install playwright dotenv
      commands:
        - export PYTHONPATH=flow_envio_resultados && python flow_envio_resultados/workflow/scripts/loja.py    
      outputFiles:
        - flow_envio_resultados/extracoes/resultado_loja.csv

    - id: exe_vd
      description: Realizar a extração dos resultados de VD
      type: io.kestra.plugin.scripts.python.Commands
      containerImage: mcr.microsoft.com/playwright/python:v1.57.0-noble
      namespaceFiles:
        enabled: true
      env:
        VD_GMAIL: "{{ kv('VD_GMAIL') }}"
        VD_PASS: "{{ kv('VD_PASS') }}"
      beforeCommands:
        - pip install playwright dotenv
      commands:
        - export PYTHONPATH=flow_envio_resultados && python flow_envio_resultados/workflow/scripts/vd.py    
      outputFiles:
        - flow_envio_resultados/extracoes/resultado_eud_C17.csv
        - flow_envio_resultados/extracoes/resultado_pef_C17.csv